$("#composeForm").on("submit",function(e){let a=$(this);e.preventDefault();var e=new FormData(this),n=$(".btn-compose");n.attr("disabled",!0),n.html('<div class="spinner-border spinner-border-sm me-2" role="status"></div>Sending...'),$.ajax({url:"/api/admin/sendmail",type:"POST",data:e,processData:!1,contentType:!1,success:function(e){1==e.status&&(n.html('<i class="bi bi-send me-2"></i>Send'),$('<div class="alert alert-success alert-dismissible fade show" role="alert"><i class="bi bi-check2-circle me-2"></i><strong>Mail sent!</strong><button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>').insertBefore(a),n.attr("disabled",!1),a[0].reset())},error:function(e,t,s){n.html('<i class="bi bi-send me-2"></i>Send'),$('<div class="alert alert-danger alert-dismissible fade show" role="alert"><i class="bi bi-exclamation-circle me-2"></i><strong>Mail cannot be sent!</strong><button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>').insertBefore(a),n.attr("disabled",!1),a[0].reset()}})});var usernameInput,fullnameInput,emailInput,passwordInput,registerBtn,currentPath=window.location.pathname;function setCookie(e,t,s){var a,n="; expires=";s&&((a=new Date).setTime(a.getTime()+24*s*60*60*1e3),n="; expires="+a.toUTCString()),document.cookie=e+"="+t+n+"; path=/; SameSite=Strict"}function cookieExists(e){for(var t=document.cookie.split(";"),s=0;s<t.length;s++)if(0===t[s].trim().indexOf(e+"="))return!0;return!1}function deleteCookie(e){expires="; expires=Thu, 01 Jan 1970 00:00:00 UTC",document.cookie=e+"="+expires+"; path=/; SameSite=Strict"}"/login"==currentPath&&($("#icon-click").on("click",function(e){var t=$("#icon");t.hasClass("bi-eye-slash")?($("#pass").attr("type","text"),t.removeClass("bi-eye-slash"),t.addClass("bi-eye")):t.hasClass("bi-eye")&&($("#pass").attr("type","password"),t.removeClass("bi-eye"),t.addClass("bi-eye-slash"))}),cookieExists("fingerprint")&&deleteCookie("fingerprint"),$("#rememberMe").on("click",function(){$("#rememberMe").is(":checked")?cookieExists("fingerprint")||fetch("https://openfpcdn.io/fingerprintjs/v3").then(e=>{e.ok&&import("https://openfpcdn.io/fingerprintjs/v3").then(e=>e.load()).then(e=>e.get()).then(e=>{setCookie("fingerprint",e.visitorId,1)})}):cookieExists("fingerprint")&&deleteCookie("fingerprint")}),$("#user, #pass, #rememberMe").on("keydown",function(e){if("Enter"===e.key)return e.preventDefault(),!1}),$(".user-login-form").on("submit",function(e){e.preventDefault(),$(".btn-login").attr("disabled",!0),$(".btn-login").html("Verifying credentials...");e=new FormData(this);$.ajax({type:"POST",url:"/api/auth/login",data:e,processData:!1,contentType:!1,success:function(e){$(".btn-login").html("Logging in..."),"Authenticated"==e.message&&location.replace(e.redirect)},error:function(e,t){"error"==t&&(0===$(".alert.alert-danger.alert-dismissible.fade.show").length&&(t=$("<div>").addClass("alert alert-danger alert-dismissible fade show").html('<i class="bi bi-exclamation-circle me-2"></i><b class="fw-semibold">Invalid credentials!</b> Please try again.<button type="button" class="btn-close shadow-none" data-bs-dismiss="alert" aria-label="Close"></button>'),$(t).insertBefore("form")),$(".btn-login").attr("disabled",!1),$(".btn-login").html("Login now!"))}})})),"/register"==currentPath&&(usernameInput=$("#username"),fullnameInput=$("#fullname"),emailInput=$("#email"),passwordInput=$("#password"),registerBtn=$(".btn-register"),$("#fullname, #username, #password, #email").on("keydown",function(e){if("Enter"===e.key)return e.preventDefault(),!1}),$(function(){function e(){var e=$(this),t=e.val().trim(),s=!1,a=e.next(".invalid-feedback"),t=("username"===e.attr("id")?(s=/^[a-zA-Z][a-zA-Z_]*$/.test(t),a.text("It should not contain any special characters except letters and underscore.")):"fullname"===e.attr("id")?(s=/^[A-Za-z]+(\s[A-Za-z]+)*$/.test(t),a.text("It should not contain numbers or special characters.")):"email"===e.attr("id")?(s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),a.text("Please enter a valid email address.")):"password"===e.attr("id")&&(s=8<=t.length,a.text("Password should contain at least 8 characters.")),e.toggleClass("is-invalid",!s),a.toggle(!s),!(usernameInput.hasClass("is-invalid")||fullnameInput.hasClass("is-invalid")||emailInput.hasClass("is-invalid")||passwordInput.hasClass("is-invalid")));registerBtn.prop("disabled",!t)}usernameInput.on("input",e),fullnameInput.on("input",e),emailInput.on("input",e),passwordInput.on("input",e)}),$(".user-register-form").on("submit",function(e){e.preventDefault(),registerBtn.html("Verifying credentials..."),registerBtn.attr("disabled",!0);e=new FormData(this);$.ajax({type:"POST",url:"/api/auth/register",data:e,processData:!1,contentType:!1,success:function(e){1==e.result?$("section.container").html(`
                    <section class="container">
                        <div class="d-flex align-items-center justify-content-center min-vh-100">
                            <div class="py-3 col-sm-10 col-md-10 col-lg-8 col-xl-6">
                                <div class="bg-black bg-opacity-25 rounded-3 p-5 text-center border">
                                    <img src="/assets/brand/photogram-logo.png"
                                        alt="logo" class="img-fluid mx-auto d-block mb-4" width="63" height="63">
                                    <h3 class="display-6">Welcome to Photogram!</h3>
                                    <p class="lead mb-4">Your account has been created.</p>
                                    <a class="text-decoration-none" href="/login">
                                        <button class="btn btn-prime hvr-icon-forward">Continue to login <i class="fa fa-arrow-right hvr-icon" aria-hidden="true"></i></button>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </section>`):console.error("Cannot insert success message")},error:function(e,t){"error"==t&&(0===$(".alert.alert-danger.alert-dismissible.fade.show").length&&(t=$("<div>").addClass("alert alert-danger alert-dismissible fade show").html('<i class="bi bi-exclamation-circle me-2"></i><b class="fw-semibold">Failed to register!</b> Invalid credentials.<button type="button" class="btn-close shadow-none" data-bs-dismiss="alert" aria-label="Close"></button>'),$(t).insertBefore("form")),registerBtn.attr("disabled",!1),registerBtn.html("Register now!"))}})})),"/forgot-password"==currentPath&&$(".forgot-password-form").on("submit",function(e){e.preventDefault(),$(".btn-send-link").attr("disabled",!0),$(".btn-send-link").html("Sending reset link to your email...");const s=new FormData(this);$.ajax({type:"POST",url:"/api/auth/reset-password",data:s,processData:!1,contentType:!1,success:function(e){$(".btn-send-link").html("Send link"),"Success"===e.status&&location.replace("/login")},error:function(e){var t;$(".btn-send-link").attr("disabled",!1),$(".btn-send-link").html("Send link"),0===$(".alert.alert-danger.alert-dismissible.fade.show").length&&(t=$("<div>").addClass("alert alert-danger alert-dismissible fade show").html(`<i class="bi bi-exclamation-circle me-2"></i><b class="fw-semibold">Mail not sent!</b> Your email, ${s.get("reset_email")}, does not exist in our database.<button type="button" class="btn-close shadow-none" data-bs-dismiss="alert" aria-label="Close"></button>`),$(t).insertBefore("form"))}})});var regex=/^\/forgot-password\/[a-zA-Z0-9]+$/;regex.test(window.location.pathname)&&($(function(){var s=$("#newPassword"),a=$("#confirmNewPassword"),n=$(".btn-change-password"),i=$(".invalid-feedback");function e(){var e=s.val(),t=a.val(),e=e===t&&0<e.length&&0<t.length;s.toggleClass("is-invalid",!e),a.toggleClass("is-invalid",!e),n.prop("disabled",!e),i.toggle(!e)}s.on("input",e),a.on("input",e)}),$(".change-password-form").on("submit",function(e){e.preventDefault();let s=$(".btn-change-password");s.attr("disabled",!0),s.html("Changing your password...");e=new FormData(this);$.ajax({type:"POST",url:"/api/auth/reset-password",data:e,processData:!1,contentType:!1,success:function(e){s.attr("disabled",!1),s.html("Change password"),"Success"==e.status?location.replace("/login"):0===$(".alert.alert-danger.alert-dismissible.fade.show").length&&(e=$("<div>").addClass("alert alert-danger alert-dismissible fade show").html('<i class="bi bi-exclamation-circle me-2"></i>Unable to change the password!<button type="button" class="btn-close shadow-none" data-bs-dismiss="alert" aria-label="Close"></button>'),$(e).insertBefore("form"))},error:function(e){var t;s.attr("disabled",!1),s.html("Change password"),0===$(".alert.alert-danger.alert-dismissible.fade.show").length&&(t=$("<div>").addClass("alert alert-danger alert-dismissible fade show").html('<i class="bi bi-exclamation-circle me-2"></i>Error occured! cannot change your password!<button type="button" class="btn-close shadow-none" data-bs-dismiss="alert" aria-label="Close"></button>'),$(t).insertBefore("form"))}})}));
//# sourceMappingURL=app.min.js.map